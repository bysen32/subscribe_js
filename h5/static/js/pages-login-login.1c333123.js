(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-login-login"],{3285:function(e,t,o){"use strict";o.r(t);var n=o("9b58"),s=o.n(n);for(var i in n)"default"!==i&&function(e){o.d(t,e,function(){return n[e]})}(i);t["default"]=s.a},"6eb7":function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[e._v("登录页面")])},s=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return s})},"9b58":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={name:"login",data:function(){return{m_ClientID:"3Iko1FonTjiaKAcoZLvetIw",m_ClientSecret:"q--YQyaUQE62bdqp9MCsRQ",m_Scope:"",m_GetCodeURL:"http://aip.app.hunnu.edu.cn/oauth2/authorize",m_AccessTokenURL:"/oauth2/access_token",m_UserInfoURL:"/oauth2/user_info",m_RefreshTokenURL:"/oauth2/refresh_token",m_RedirectURL:null,m_Code:null,m_AccessToken:null,m_RefreshToken:null}},methods:{UserInfo:function(){console.log(this.$store.getters.UserInfo),console.log(this.$store.getters.LoginState)},ClearCookie:function(){this.$cookie.delete("refreshToken"),this.$cookie.delete("accessToken"),this.$cookie.delete("redirectURL")},ForceRefresh:function(){this.ClearCookie(),this.$store.commit("SetLoginState",!1),this.BackToMain()},SetLoginStateTrue:function(){this.$store.commit("SetLoginState",!0)},SetLoginStateFalse:function(){this.$store.commit("SetLoginState",!1)},AutoLogin:function(){this.$cookie.set("redirectURL",location.href,1),this.redirectURL=location.href,location.href=this.formatCodeURL},testCode:function(){this.GetAccessToken()},testInfo:function(){this.GetUserInfo()},saveURL:function(){var e=this.getQueryObject(location.href);e.state!==this.state&&(this.$cookie.set("redirectURL",location.href,1),location.href=this.formatCodeURL)},GetCode:function(){var e=this.getQueryObject(location.href);e.code&&(this.m_Code=e.code)},GetAccessToken:function(){var e=this,t={client_id:this.m_ClientID,client_secret:this.m_ClientSecret,grant_type:"authorization_code",redirect_uri:"",code:this.m_Code};uni.request({url:this.m_AccessTokenURL,data:t,responseType:"text",header:{Accept:"application/json"},success:function(t){t.data.errorCode?e.ForceRefresh():t.data.access_token&&(e.UpdateAccessToken(t.data),e.GetUserInfo())},fail:function(t){e.ForceRefresh()}})},RefreshToken:function(){var e=this,t={client_id:this.m_ClientID,client_secret:this.m_ClientSecret,grant_type:"refresh_token",refresh_token:this.m_RefreshToken};console.log("Check RefreshToken"),uni.request({url:this.m_RefreshTokenURL,method:"GET",data:t,dataType:"json",header:{Accept:"application/json"},success:function(t){t.data.errorCode?e.ForceRefresh():t.data.access_token&&(e.UpdateAccessToken(t.data),e.GetUserInfo())},fail:function(t){console.log(t),e.ForceRefresh()}})},UpdateAccessToken:function(e){this.m_RefreshToken=e.refresh_token,this.$cookie.set("accessToken",e.access_token,e.expires_in+"s"),this.$cookie.set("refreshToken",this.m_RefreshToken,e.re_expires_in+"s")},GetUserInfo:function(){var e=this,t={access_token:this.$cookie.get("accessToken")};uni.request({url:this.m_UserInfoURL,method:"GET",data:t,dataType:"json",header:{Accept:"application/json"},success:function(t){if(t.data.errorCode)e.ForceRefresh();else{var o=t.data;e.$store.commit("SetLoginState",!0),e.$store.commit("SetUserInfo",o),e.BackToMain()}},fail:function(t){console.log(t),e.ForceRefresh()}})},LogOut:function(){this.$cookie.delete("refreshToken")},getQueryObject:function(e){e=null===e?window.location.href:e;var t=e.substring(e.lastIndexOf("?")+1),o={},n=/([^?&=]+)=([^?&=]*)/g;return t.replace(n,function(e,t,n){var s=decodeURIComponent(t),i=decodeURIComponent(n);return o[s]=i,e}),o},BackToMain:function(){uni.reLaunch({url:"/pages/top20/top20"})}},computed:{formatCodeURL:function(){return"".concat(this.m_GetCodeURL,"?client_id=").concat(this.m_ClientID,"&response_type=code&redirect_uri=").concat(location.href)}},onReady:function(){this.$store.getters.LoginState&&this.BackToMain(),this.GetCode(),this.m_RefreshToken=this.$cookie.get("refreshToken"),this.m_RefreshToken?this.RefreshToken():this.m_Code?this.GetAccessToken():this.AutoLogin()}};t.default=n},a86a:function(e,t,o){"use strict";o.r(t);var n=o("6eb7"),s=o("3285");for(var i in s)"default"!==i&&function(e){o.d(t,e,function(){return s[e]})}(i);var c=o("2877"),r=Object(c["a"])(s["default"],n["a"],n["b"],!1,null,"0c8043d0",null);t["default"]=r.exports}}]);